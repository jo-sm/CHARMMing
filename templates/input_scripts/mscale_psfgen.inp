!! begin mscale_psfgen.inp

{%comment%}
We need to load in the whole structure, then delete atoms on a per-region basis.
e.g. in a 3-layer system, where r1 is high, r2 is med, r3 is all:
write PSF for r3 (no change)
delete .not. (r1 .or. r2)
write PSF for r2
delete .not. (r1)
write PSF for r1.

This is repeated for as many layers as we want.{%endcomment%} blankme

calc region = @nregion - 1 ! already written the top layer with everything

label loop
delete atom sele .not. reg@region end {%comment%} We only delete not in a certain region, since it automatically contains the region below it. {%endcomment%}

write psf card name {{psf_path}}layer@{nregion}.psf
write coor card name {{psf_path}}layer@{nregion}.crd

incr region by -1

! all of our definitions got squished by the deletion, so we need to re-read them
if @region .gt. 0 then stream regdef@{region}.str
if @region .gt. 0 then goto loop
