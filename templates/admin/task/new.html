{% extends 'layout.html' %}

{% block title %} Administration :: New Task {% endblock %}
{% block html_class %} admin-task-new {% endblock %}

{% block content %}
<div class='title'>
  Create New Task
</div>
Create a new task for
<select name='program_set'>
  {% for program_set in program_sets %}
    <option value='{{ program_set.id }}'>{{ program_set.name }}</option>
  {% endfor %}
</select>
<form action='/admin/task/new' method='post'>
  <label>Task Name</label>
  <input type='text' name='name'>

  <label>Task Description</label>
  <input type='text' name='description'>

  <div class='info'>
    Define a set of parameters that the task input script will accept, and can be defined at job creation. Please note that if the parameter is marked as required, it must be present in the template as well.
  </div>
{% verbatim %}
  <script id='parameters-form' type='text/ractive'>
    <div id='parameters'>
        <div class='list'>
          <div id='new'>
            <div id='new_param' class='button' on-click='new-parameter'>Add Parameter <i class='ion-plus'></i></div>

            <ul class='tabs vertical'>
              {{#parameters: param}}
                <li class='tab-title'><a class='tab' href='#tab-{{id}}'>{{displayName}}</a></li>
              {{/parameters}}
            </ul>
          </div>
        </div>
        <div class='parameter tabs-content'>
            {{#parameters}}
              <div class='tab-content' id='tab-{{id}}'>
                {{>parameter}}
              </div>
            {{/parameters}}
      </div>
    </div>
  </script>

  <script id='parameter' type='text/ractive'>
    <div class='row'>
        <div class='name'>
          <label>Template Variable Name <input type='text' name='name-{{id}}' value='{{name}}'></label>
        </div>

        <div class='display-name'>
          <label>Display Name <input type='text' name='display_name-{{id}}' value='{{displayName}}'></label>
        </div>

        <div class='description'>
          <label>Description <input type='text' name='description-{{id}}' value='{{description}}'></label>
        </div>
      </div>
      <div class='row'>
        <div class='type'>
          <label>Type of Input
            <select name='type-{{id}}' value='{{type.name}}'>
              <option value='text'>Text field</option>
              <option value='radio'>Radio Button</option>
              <option value='checkbox'>Checkbox</option>
            </select>
          </label>
        </div>

        <div class='type-options'>
          {{#type}}
            {{#if name === 'checkbox'}}
              Checked value: <input type='text' name='type-{{id}}-checkbox-checked' value='{{checkedValue}}'>
            {{/if}}

            {{#if name === 'radio'}}
            Values: (<span class='ion-plus-round' on-click='add-radio-value'></span>)
              {{#values:i}}
                <div>
                  Name: <input name='type-{{id}}-radio-name-{{i}}' value='{{.name}}'>
                  Value: <input name='type-{{id}}-radio-value-{{i}}' value='{{.value}}'>
                </div>
              {{/values}}
            {{/if}}
          {{/type}}
        </div>

        <div class='required'>
          <label>Required <input type='checkbox' name='required-{{id}}'></label>
        </div>
      </div>

      <div class='row'>
        <div class='conditional'>
          <label>Conditional Upon...
            <select name='conditional-{{id}}' value='{{conditional}}'>
              <option value='none'>Nothing</option>
              {{#parameters}}
                  <option value='{{.id}}'>{{../id}} : {{.displayName}}</option>
              {{/parameters}}
            </select>
          </label>
          {{#if conditional}}
            {{#parameters}}
              {{#if .id == ../../conditional}}
                {{type}}
              {{/if}}
            {{/}}
          {{/if}}
        </div>
        <div class='order'>
          <label>Order on Page
            <select name='order-{{id}}' value='{{order}}'>
              {{#parameters}}
                <option>{{.id}}</option>
              {{/parameters}}
            </select>
          </label>
        </div>
      </div>
  </script>
{% endverbatim %}
  <div id='parameters'></div>
  <div class='clear'>
    <label>Task Template</label>
    <textarea name='template' rows='10'></textarea>
  </div>

  <input class='button' type='submit' value='Create'>
</form>

{% endblock %}
