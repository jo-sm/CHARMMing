<head>
<link href="/charmming/css/custom.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="/charmming/js/custom.js"> </script>
<script type="text/javascript" src="/charmming/js/BubbleTooltips.js"> </script>
<link href="/charmming/css/bt.css" rel="stylesheet" type="text/css"/>
<script src="/charmming/js/protoculous-1.0.2-packed.js" type="text/javascript"></script>


<script type="text/javascript">
var last_option_id ="";

function setOptionId(div)
{
 last_option_id = div.id;
}

function doOnLoad()
{
 enableTooltips();
}

function addResidue(residue)
{
 sequ_field = document.getElementById('id_sequ');
 sequ_text = document.getElementById('id_sequ').value;
 //If the line is not blank, add a space
 if(sequ_text.length > 1)
 {
  sequ_text += " ";
 }
 sequ_text += residue;
 sequ_field.value = sequ_text;
}

//This swaps two words separated by an underscore
//example: bob_pdb is returned as pdb_bob
//this is done because the form ID is the inverse
//of the div_id it controls
//upload_pdb controls pdb_upload
function getChoiceDiv(div_id)
{
 var re =  /[a-z]*/;
 var first_part = re.exec(div_id);
 var re2 = /_[a-z]*/;
 var second_part = re2.exec(div_id);
 second_part[0] = second_part[0].replace(/[_]/,'');
 new_div = second_part[0] + "_" + first_part[0];
 return new_div;
}
//displays the div_id sent to it, specially designed for
//fileuploadform page
function displayFields(div_id)
{
 if(div_id !='rtf_upload' && div_id != 'prm_upload')
 {
  var choices = document.getElementsByName('submit_structure_option');
  for(var i=0; i < choices.length; i++)
  {
   if(getChoiceDiv(choices[i].id) != div_id)
    choices[i].checked = false;
    setVisible(getChoiceDiv(choices[i].id),"none");
  }
 }
 if(div_id == 'rtf_upload' || div_id == 'prm_upload')
 {
  if(isVisible(div_id))
  {
   setVisible(div_id,"none");
  }
  else
  {
   setVisible(div_id,"block");
  }
  checkId(last_option_id);
  setVisible(getChoiceDiv(last_option_id),"block");
  return;
 }
 if(isVisible(div_id))
  setVisible(div_id,"none");
 else if(div_id == 'crd_upload')
 {
  setVisible(div_id,"block");
  setVisible('psf_upload',"block");
 }
 else
  setVisible(div_id,"block");

}

{{left}} ifequal lessonuser 1 {{right}}
  //This gets the lesson value then passes it to the parent
  function getLessonValue()
  {
    return document.getElementById("lesson").value;
  }
{{left}} endifequal {{right}}

//This is needed otherwise the radio button selection moves
//to the replace/append under topology/parameter
//I'm assuming it's a javascript shortcoming
function leavecheck()
{
 field.checked = true;
}
</script>

</head>
<body bgcolor=#FFFFFF onload="doOnLoad();">
   <center>
   <div>
      <h1>Upload Structure</h1>
      <hr width="50%">
   </div>
<!--</form>--!>
<!--</fieldset>--!>
   <h3>What would you like to do?<h3>
   <hr width="50%">
   <form id="choose_options">
      <table cellspacing="4" cellpadding="7">
         <tr>
            <td><p class="fontlarge">Retrieve a PDB using a PDB ID </p></td> <td><input type="radio" name="submit_structure_option" id="download_pdb" onclick="displayFields('pdb_download');setOptionId(this);"></td>
            <td><a href="" title="Each PDB in http://www.pdb.org has a alphanumeric code assoicated with it. Type in the code and this interface will automatically retrieve then parse it.">?</a></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
         <tr>
            <td><p class="fontlarge">Upload my own PDB file</p></td><td> <input type="radio" name="submit_structure_option" id="upload_pdb" onclick="displayFields('pdb_upload');setOptionId(this);"></td>
            <td><a href="" title="If you have a custom generated input file,then upload it here and the interface will put it in CHARMM format.">?</a></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
         <tr>
            <td><p class="fontlarge">Upload my own CRD/PSF file</p></td><td> <input type="radio" name="submit_structure_option" id="upload_crd" onclick="displayFields('crd_upload');setOptionId(this);"> 
	    <input type="hidden" name="submit_structure_option" id="upload_psf"></td>
            <td><a href="" title="CRD files are CHARMM-specific files that have a similar function as PDB files. If you upload a CHARMM CRD file, you must also upload a CHARMM PSF file.">?</a></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
         <tr>
            <td><p class="fontlarge">Create my own PDB Sequence </p> </td><td><input type="radio" name="submit_structure_option" id="make_pdb" onclick="displayFields('pdb_make');setOptionId(this);"></td>
            <td><a href="" title="You can define your own sequence by typing in the amino acids you want. Use the three letter abbreviation followed by a space (e.g. ALA GLY TYR).">?</a></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
         <tr>
            <td><p class="fontlarge">Add my own topology file</p></td><td> <input type="checkbox" name="upload_rtf" id="upload_rtf" onclick="displayFields('rtf_upload');">
	    <td><a href="" title="Topology files contain residue information. Residues in CHARMM are subunits, such as amino acids or nucleic acids.">?</a></td></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
         <tr>
            <td><p class="fontlarge">Add my own parameter file </p></td><td><input type="checkbox" name="upload_prm" id="upload_prm" onclick="displayFields('prm_upload');"></td><td><a href="" title="Parameter files store bond/nonbond information along with atom parameters.">?</a></td>
         </tr>
         <tr><td colspan=3><hr width="100%"></td></tr>
      </table>
   </form>

   {{left}} ifequal lessonvalue 1 {{right}}
     <form id='submit_structure' enctype="multipart/form-data" method="post" action="/charmming/fileupload/" onsubmit="window.parent.showLesson(getLessonValue());">
   {{left}} else {{right}}
     <form id='submit_structure' enctype="multipart/form-data" method="post" action="/charmming/fileupload/">
   {{left}} endifequal {{right}}
      <fieldset class="structure">
         <legend class="login">Submit Structure</legend>
            <div id='pdb_upload' style="display:none"><p><label for="id_pdb"> PDB File Uploader </label> {{left2}} form.pdbupload {{right2}} {{left2}} form.pdbupload_file {{right2}}</div>
            <div id='crd_upload' style="display:none"><p><label for="id_pdb"> CRD File Uploader </label> {{left2}} form.pdbupload {{right2}} {{left2}} form.pdbupload_file {{right2}}</div>
            <div id='psf_upload' style="display:none"><p><label for="id_psf"> PSF File Uploader </label> {{left2}} form.psfupload {{right2}} {{left2}} form.psfupload_file {{right2}}</div>
            <div id='pdb_download' style="display:none"><p><label for="id_pdbid"> PDB.org ID </label> {{left2}} form.pdbid {{right2}} {{left2}} form.proto {{right2}} </div>
            <div id='pdb_make' style="display:none"><p><label for="id_sequ"> Custom Sequence </label>{{left2}} form.sequ {{right2}}
	    <br>
	    <br>
            <fieldset class="custom_sequ">
              <legend class="custom_sequ">Click residue to create sequence</legend>
	     <div class="colwrapper">
	      <div class="col1">
	       Acidic:<br>
	       <a href="javascript:addResidue('ASP');">ASP-Aspartic Acid </a><br>
	       <a href="javascript:addResidue('ASPP');">ASPP-Aspartic Acid* </a><br>
	       <a href="javascript:addResidue('GLU');">GLU-Glutamic Acid </a><br>
	       <a href="javascript:addResidue('GLUP');">GLUP-Glutamic Acid* </a><br>
	       <a href="javascript:addResidue('HSP');">HSP-Histidine*</a><br>
	       Basic:<br>
	       <a href="javascript:addResidue('ARG');">ARG-Arginine </a><br>
	       <a href="javascript:addResidue('LYS');">LYS-Lysine </a><br>

	       Neutral:<br>
	       <a href="javascript:addResidue('ALA');">ALA-Alanine</a><br>
	       <a href="javascript:addResidue('ASN');">ASN-Asparagine</a><br>
	       <a href="javascript:addResidue('CYS');">CYS-Cysteine </a><br>
	       <a href="javascript:addResidue('GLN');">GLN-Glutamine </a><br>
	       <a href="javascript:addResidue('GLY');">GLY-Glycine </a><br>
	      <div style="position:absolute;left:205px;top:0">
	       <a href="javascript:addResidue('HSD');">HISD-Histidine*</a><br>
	       <a href="javascript:addResidue('HSE');">HSE-Histidine*</a><br>
	       <a href="javascript:addResidue('ILE');">ILE-Isoleucine </a><br>
	       <a href="javascript:addResidue('LEU');">LEU-Leucine </a><br>
	       <a href="javascript:addResidue('LSN');">LSN-Lysine* </a><br>
	       <a href="javascript:addResidue('MET');">MET-Methionine </a><br>
	       <a href="javascript:addResidue('PHE');">PHE-Phenylalanine </a><br>
	       <a href="javascript:addResidue('PRO');">PRO-Proline </a><br>
	       <a href="javascript:addResidue('SER');">SER-Serine </a><br>
	       <a href="javascript:addResidue('THR');">THR-Threonine </a><br>
	       <a href="javascript:addResidue('TRP');">TRP-Tryptophan </a><br>
	       <a href="javascript:addResidue('TYR');">TYR-Tyrosine </a><br>
	       <a href="javascript:addResidue('VAL');">VAL-Valine </a><br>
	      </div>
	      <br>
		*Protonated states
	      </fieldset>
	     </div>
            </div>
            <div id='rtf_upload' style="display:none"><p><label for="id_pdb"> Topology File </label> {{left2}} form.rtf_file {{right2}} {{left2}} form.rtf_file_file {{right2}}</p>
              <div style="font-size:small;">
                Append this to the default CHARMMing topology file <input type="radio" name="rtf_append_or_replace" id="rtf_append_or_replace" value="append"><br>
                Replace the default CHARMMing topology file with this topology file <input type="radio" name="rtf_append_or_replace" id="rtf_append_or_replace" value="replace" checked>
              </div>
            </div>

            <div id='prm_upload' style="display:none"><p><label for="id_pdb"> Parameter File </label> {{left2}} form.prm_file {{right2}} {{left2}} form.prm_file_file {{right2}}</p>
              <div style="font-size:small;">
                Append this to the default CHARMMing parameter file<input type="radio" name="prm_append_or_replace" id="prm_append_or_replace" value="append"><br>
                Replace the default CHARMMing parameter file with this parameter file<input type="radio" name="prm_append_or_replace" id="prm_append_or_replace" value="replace" checked>
              </div>
            </div>
      </fieldset>
      <br />
      {{left}} ifequal lessonuser 1 {{right}}
       What Lesson is this structure associated with?<br>
        <select name="lesson" id="lesson"> 
         <option value="nolesson" selected> No Lesson </option>
         {% for dict in lesson_info_lis %} blankme
         <option value="lesson{{dict.lesson_num}}"> Lesson {{dict.lesson_num}} </option>
         {% endfor %} blankme
        </select><br><br>
      {{left}} endifequal {{right}}
      <input type="submit" value="Submit Structure"/>
   </form>
</center>
</body>
</html>
