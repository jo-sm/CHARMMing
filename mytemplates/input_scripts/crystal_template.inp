   ! set up crystal
   {% if not solvation_structure or solvate_implicitly %} blankme
      ! we need to figure out the dimensions of the structure for use in calculating
      ! the proper unit cell size and correctly setting up the crystal structure.
      ! The solvation structure uses bwat as the segment ID for the solvent, so we
      ! do a coor stat on anything not in that segment.
      coor stat select .not. segid bwat end

      calc xdim = abs ( ?XMAX - ?XMIN )
      calc ydim = abs ( ?YMAX - ?YMIN )
      calc zdim = abs ( ?ZMAX - ?ZMIN )
      if @xdim .gt. @ydim
      CHARMM-scripts if @xdim .gt. @zdim
      CHARMM-scripts  goto crystalx

      if @ydim .gt. @xdim
      CHARMM-scripts if @ydim .gt. @zdim
      CHARMM-scripts goto crystaly

      if @zdim .gt. @ydim
      CHARMM-scripts if @zdim .gt. @xdim
      CHARMM-scripts  goto crystalz

      label crystalx
      set greatervalue @xdim
      goto crystal

      label crystaly
      set greatervalue @ydim
      goto crystal

      label crystalz
      set greatervalue @zdim
      goto crystal

      label crystal
   {% endif %} blankme
   {% if relative_boundary %} blankme
      ! read crystal dimensional data from the crystal structure made in solvation
      stream crystl_{{filebase}}.str
      {% include 'input_scripts/choose_for_me.inp' %}
   {% endif %} blankme
   {% if not solvation_structure or solvate_implicitly %} blankme
      calc greatervalue = @greatervalue + 20
      crystal define cubic @greatervalue @greatervalue @greatervalue 90. 90. 90.
      crystal build noper 0
   {% else %} blankme
      {% include 'input_scripts/rhdo_hexa_cubic.inp' %}      
   {% endif %} blankme

