{% extends "input_scripts/generic_charmm_script.inp" %} blankme

{% block title %}Simple Energy Calculation {% endblock %}

{% block body %} blankme
  {% include 'input_scripts/solvate_implicity.inp' %}
  {% ifequal fixnonh 1 %} blankme
    cons fix sele .not. hydrogen end
  {% endifequal %} blankme
  {% ifequal fixnonh 2 %} blankme
    {% include "input_scripts/fix_other_atoms.inp" %}
    cons fix sele .not. notfix end
  {% endifequal %} blankme

  {% include 'input_scripts/use_shake.inp' %}
  {% if restraints %} blankme
    {{restraints}}
  {% endif %} blankme
  {% if usepbc and not dopbc %} blankme
    !! NOTICE: you requested minimization with PBC, but that is not valid on spherically solvated systems!
  {% endif %} blankme
  {% if dopbc %} blankme
    {% include 'input_scripts/crystal_template.inp' %}
    ! set images
    {% if not solvation_structure or solvate_implicitly %} blankme 
      image byseg sele all end
      ! set up nonbond params to be the same as is used in minimization and dynamics.
      {% include 'input_scripts/nopbc_nonbond.inp' %}
    {% else %} blankme
      open unit 1 read card name new_{{filebase}}.xtl
      crystal read card unit 1
      close unit 1
      ! set up nonbond params to be the same as is used in minimization and dynamics.
      {% include 'input_scripts/calc_ewald.inp' %}
      {% include 'input_scripts/standard_nonbond.inp' %}
    {% endif %} blankme
  {% else %} blankme 
    {% include 'input_scripts/nopbc_nonbond.inp' %}
  {% endif %} blankme
  {% if useqmmm %} blankme
    {% include "input_scripts/make_qchem.inp" %}
  {% endif %} blankme
  !calcalate energy
  ENERGY 
  {# % include "input_scripts/write_out_append_or_energy.inp" % #}
  {% include "input_scripts/write_out_struct.inp" %}

{% endblock %}

