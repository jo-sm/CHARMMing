{% extends "input_scripts/generic_charmm_script.inp" %} blankme

{% block title %}Minimize structure{% endblock %}

{% block body %} blankme
  {% if restraints %} blankme
    {{restraints}}
  {% endif %} blankme
  {% include 'input_scripts/solvate_implicity.inp' %}
  {% include 'input_scripts/use_shake.inp' %}
  {% if restraints %} blankme
    {{restraints}}
  {% endif %} blankme

  {% if dopbc %} blankme
    {% include 'input_scripts/setup_pbc.inp' %}
  {% endif %} blankme

  coor copy comp

  !!BTM foo
  {% if useqmmm %} blankme
    !!BTM useqmmm on
    {%if modelType == "qmmm" %} blankme
     !!BTM make_qchem
     {% include "input_scripts/make_qchem.inp" %} blankme
    {%else %} blankme
      {% if modelType == "oniom" %} blankme
        {% include "input_scripts/mscale_oniom.inp" %}
      {%endif%} blankme
    {%endif%} blankme
  {% else %}
    {% if restrainbb %}
      cons rmsd force {{ bbforce }} sele type n .or. type ca .or. type c .or. type o end
    {% endif %}
  {% endif %} blankme
  !!BTM bar

  mini SD nstep {{sdsteps}} 
  mini abnr nstep {{abnr}} nprint 100 tolg {{tolg}}
  coor rms

  {% if restrainbb %}
    cons rmsd clear
  {% endif %}

  {% include "input_scripts/write_out_struct.inp" %}

{% endblock %} blankme


