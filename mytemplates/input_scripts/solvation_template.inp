{% extends "input_scripts/generic_charmm_script.inp" %} blankme

{% block title %}Solvate Protein {% endblock %}
   ! solvation structure is {{solvation_structure}}

   ! Read protein structure from PSF file

{% block body %} blankme

   ! TIM: orient about origin so the alignment is correct with the
   ! water crystal.
   coordinate orient

   ! Takes statistics on coordinates to figure out the minimum, maximum, and
   ! average values of the X, Y, and Z coordinates. These are stored in 
   ! XMIN,XMAX,XAVE,YMIN,YMAX,YAVE,ZMIN,ZMAX,ZAVE.
   coordinate statistics select all end

   ! Read in water sequence
   read sequ tip3 46656

   ! Generate new segment for the water
   generate bwat noangle nodihedral

   ! Read the water coordinates and append them to the protein
   read coor card append name /usr/local/charmming/solvation/water.crd
   coor orient noro select segid bwat end

   ! Delete waters which overlap with protein
   delete atom sort -
   select .byres. (segid bwat .AND. type oh2 .and. -
   ((.not. (segid bwat .OR. hydrogen)) .around. 2.5)) end

   {% ifequal solvation_structure "sphere" %}
      ! handle sphere
   {% else %}
      ! handle periodic unit cell
   {% endifequal %}

   {% include 'input_scripts/use_shake.inp' %}
   ! Do a quick and dirty minimization to reduce bad image contacts...
   mini sd nstep 100 nprint 1 tolgrd 100.0
   {% include 'input_scripts/write_out_struct.inp' %}
{% endblock %}

