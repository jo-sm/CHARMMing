{%comment%} One day, Django 1.4+ will deliver us from the scourge of the endless if test.{%endcomment%} blankme

! make qchem template here...

{% if bad_exchange %} blankme  
   bomlev 3
   achtung, bad QM exchange!
   stop
{% endif %}

{% if bad_correlation %} blankme
   bomlev 3
   achtung, bad QM correlation!
   stop
{% endif %}

{% if bad_basis %} blankme
   bomlev 3
   achtung, bad QM basis set!    
   stop
{% endif %}

{% if bad_jobtype %} blankme
   bomlev 3
   achtung, bad QM job type! 
   stop
{% endif %}

{% ifequal jobtype 'freq' %} blankme 
   !TQM {{tqm}} 
   {% ifequal tqm 'all' %} blankme
   {% else %} blankme     
      ! check to make sure the QM region is not all atoms (if it's not sele all end)
      ! unless you select all the Q-Chem script assumes that there are some MM atoms.
      define junk sele {{qmsel}} end 
      if ?nsel .ne. ?natom then goto qmok
      achtung, QM region is all atoms, please use ALL as your selection!
      label qmok
  {% endifequal %} blankme
{% endifequal %} blankme

coor copy comp
coor shake

! set our bynum selections up first
set nbynum = {{ bynum_list|length }}
{% for item in bynum_list %} blankme
set bynuma{{ forloop.counter }} = {{ item.numa }}
set bynumb{{ forloop.counter }} = {{ item.numb }}
{% endfor %} blankme

! then our regions
set nregion = 1 ! always 1 QM region
{% for item in region_list %} blankme
set regid{{ forloop.counter }} = {{ item }}
{% endfor %} blankme

! finally our link atoms
set nlink = {{ linkat_list|length }}
{% for item in linkat_list %} blankme
set segq{{ forloop.counter }} = {{ item.segq }}
set resq{{ forloop.counter }} = {{ item.resq }}
set atypq{{ forloop.counter }} = {{ item.atypq }}
set segm{{ forloop.counter }} = {{ item.segm }}
set resm{{ forloop.counter }} = {{ item.resm }}
set atypm{{ forloop.counter }} = {{ item.atypm }}
{% endfor %} blankme

! and begin
stream {{data_home}}/renumber.str


!---------- Needed to define Q-Chem env. vars. ----------
envi qchemcnt  "{{qchemin}}"
envi qcheminp  "{{qcheminp}}"
envi qchemexe  "qchem.tim"
envi qchemout  "{{qchemout}}"
!--------------------------------------------------------

qchem remove sele reg1 show end  

